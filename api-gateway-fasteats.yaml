openapi: "3.0.1"
info:
  title: "API Gateway FASTEATS"
  version: "v.1.0.0"
servers:
  - url: "https://z6l6728toj.execute-api.us-east-1.amazonaws.com/{basePath}"
    variables:
      basePath:
        default: "prod"
tags:
  - name: Status do Pedido
    description: Controller que gerencia os status de pedido
  - name: Categoria
    description: Controller que gerencia as categorias de produtos.
  - name: Produto
    description: Controller que gerencia os produtos
  - name: Pedido
    description: Controller que gerencia o processo de criação de um pedido
  - name: Produto do Pedido
    description: Controller que gerencia os itens do pedido
  - name: Cliente
    description: Controller que gerencia os clientes
  - name: Gerenciar Pedidos
    description: Controller que gerencia detalhes de um pedido.
  - name: STS
    description: Gerar Security token service.
paths:
  /sts-token:
    post:
      tags:
        - STS
      responses:
        "200":
          description: "200 response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Empty"
      x-amazon-apigateway-integration:
        httpMethod: "POST"
        uri: "arn:aws:apigateway:${aws_region}:lambda:path/2015-03-31/functions/${lambda_sts_arn}/invocations"
        responses:
          default:
            statusCode: "200"
        passthroughBehavior: "when_no_match"
        contentHandling: "CONVERT_TO_TEXT"
        type: "aws"
  /pedidos:
    get:
      tags:
        - Pedido
      parameters:
        - name: Authorization
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 200 response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'
      security:
        - lambda_authorizador: []
      x-amazon-apigateway-integration:
        httpMethod: GET
        uri: "http://${nlbpedido}/pedidos"
        responses:
          default:
            statusCode: "200"
        requestParameters:
          integration.request.header.Authorization: method.request.header.Authorization
        passthroughBehavior: when_no_match
        type: http
    post:
      tags:
        - Pedido
      parameters:
        - name: Authorization
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 200 response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'
      security:
        - lambda_authorizador: []
      x-amazon-apigateway-integration:
        httpMethod: POST
        uri: "http://${nlbpedido}/pedidos"
        responses:
          default:
            statusCode: "200"
        requestParameters:
          integration.request.header.Authorization: method.request.header.Authorization
        passthroughBehavior: when_no_match
        type: http
  /pedidos/{idPedido}:
    get:
      tags:
        - Pedido
      parameters:
        - name: idPedido
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 200 response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'
      security:
        - lambda_authorizador: []
      x-amazon-apigateway-integration:
        httpMethod: GET
        uri: "http://${nlbpedido}/pedidos/{idPedido}"
        responses:
          default:
            statusCode: "200"
        requestParameters:
          integration.request.path.idPedido: method.request.path.idPedido
        passthroughBehavior: when_no_match
        type: http
    delete:
      tags:
        - Pedido
      parameters:
        - name: idPedido
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 200 response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'
      security:
        - lambda_authorizador: []
      x-amazon-apigateway-integration:
        httpMethod: DELETE
        uri: "http://${nlbpedido}/pedidos/{idPedido}"
        responses:
          default:
            statusCode: "200"
        requestParameters:
          integration.request.path.idPedido: method.request.path.idPedido
        passthroughBehavior: when_no_match
        type: http
    patch:
      tags:
        - Pedido
      parameters:
        - name: idPedido
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 200 response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'
      security:
        - lambda_authorizador: []
      x-amazon-apigateway-integration:
        httpMethod: PATCH
        uri: "http://${nlbpedido}/pedidos/{idPedido}"
        responses:
          default:
            statusCode: "200"
        requestParameters:
          integration.request.path.idPedido: method.request.path.idPedido
        passthroughBehavior: when_no_match
        type: http
  /pedidos/{idPedido}/cancelar:
    patch:
      tags:
        - Pedido
      parameters:
        - name: idPedido
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 200 response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'
      security:
        - lambda_authorizador: []
      x-amazon-apigateway-integration:
        httpMethod: PATCH
        uri: "http://${nlbpedido}/pedidos/{idPedido}/cancelar"
        responses:
          default:
            statusCode: "200"
        requestParameters:
          integration.request.path.idPedido: method.request.path.idPedido
        passthroughBehavior: when_no_match
        type: http
  /pedidos/{idPedido}/confirmar:
    patch:
      tags:
        - Pedido
      parameters:
        - name: idPedido
          in: path
          required: true
          schema:
            type: string
        - name: tipoPagamentoId
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 200 response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'
      security:
        - lambda_authorizador: []
      x-amazon-apigateway-integration:
        httpMethod: PATCH
        uri: "http://${nlbpedido}/pedidos/{idPedido}/confirmar"
        responses:
          default:
            statusCode: "200"
        passthroughBehavior: when_no_match
        type: http

#COMPONENTES
components:
  schemas:
    Empty:
      title: "Empty Schema"
      type: "object"
  securitySchemes:
    lambda-authorizer:
      type: "apiKey"
      name: "Authorization"
      in: "header"
      x-amazon-apigateway-authtype: "custom"
      x-amazon-apigateway-authorizer:
        authorizerUri: "arn:aws:apigateway:${aws_region}:lambda:path/2015-03-31/functions/${lambda_authorizer_arn}/invocations"
        authorizerResultTtlInSeconds: 300
        identitySource: "method.request.header.Authorization"
        type: "request"
